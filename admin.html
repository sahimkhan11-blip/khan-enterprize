<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; padding: 20px; background: #f1f5f9; color: #333; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #eee; }
        .tabs button { padding: 10px 20px; margin-right: 10px; cursor: pointer; border: none; border-radius: 5px; font-weight: 600; background: #e2e8f0; }
        .tabs button.active { background: #2563eb; color: white; }
        
        .admin-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: #f8fafc; padding: 20px; border-radius: 10px; border: 1px solid #e2e8f0; margin-bottom: 20px; }
        .full { grid-column: span 2; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        .upload-box { grid-column: span 2; border: 2px dashed #cbd5e1; padding: 20px; text-align: center; background: white; cursor: pointer; }
        .upload-preview { max-height: 100px; display: none; margin-top: 10px; }
        
        .btn { padding: 10px 20px; border-radius: 5px; border: none; color: white; cursor: pointer; font-weight: bold; }
        .btn-add { background: #10b981; } .btn-edit { background: #3b82f6; } .btn-del { background: #ef4444; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f1f5f9; }
        
        .section { display: none; } .section.active { display: block; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h2>‚öôÔ∏è Admin Panel</h2>
            <a href="index.html" style="text-decoration:none; color:#2563eb; font-weight:bold;">Go to Shop</a>
        </div>

        <div class="tabs">
            <button class="active" onclick="tab('products')">Manage Products</button>
            <button onclick="tab('orders')">Manage Orders</button>
        </div>

        <div id="products" class="section active">
            <div class="admin-form">
                <input type="hidden" id="edit_id">
                <input type="text" id="p_name" placeholder="Product Name">
                <input type="number" id="p_price" placeholder="Price">
                <select id="p_status"><option value="true">In Stock</option><option value="false">Out of Stock</option></select>
                
                <textarea id="p_desc" class="full" rows="3" placeholder="Product Details / Description"></textarea>

                <div class="upload-box" onclick="document.getElementById('p_file').click()">
                    <input type="file" id="p_file" hidden accept="image/*" onchange="handleImg(this)">
                    <span>üì∑ Click to Upload Image</span><br><img id="p_prev" class="upload-preview">
                </div>
                
                <div class="full">
                    <button class="btn btn-add" id="addBtn" onclick="addProduct()">Add Product</button>
                    <button class="btn btn-edit" id="updateBtn" onclick="updateProduct()" style="display:none;">Update</button>
                    <button class="btn" onclick="resetForm()" style="background:#666;">Clear</button>
                </div>
            </div>

            <table>
                <thead><tr><th>Img</th><th>Name</th><th>Details</th><th>Price</th><th>Stock</th><th>Action</th></tr></thead>
                <tbody id="p_list"></tbody>
            </table>
        </div>

        <div id="orders" class="section">
            <button class="btn" onclick="renderOrders()" style="background:#f59e0b; margin-bottom:10px;">Refresh Orders</button>
            <table>
                <thead><tr><th>ID</th><th>Customer</th><th>Address</th><th>Items</th><th>Status</th><th>Action</th></tr></thead>
                <tbody id="o_list"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Auth Check
        const user = JSON.parse(localStorage.getItem('user'));
        if(!user || user.role !== 'admin') window.location.href="index.html";

        let products = JSON.parse(localStorage.getItem('products')) || [];
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let curImg = "";

        function tab(t) {
            document.querySelectorAll('.section').forEach(e=>e.classList.remove('active'));
            document.querySelectorAll('.tabs button').forEach(e=>e.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            event.target.classList.add('active');
            if(t==='products') renderP(); else renderO();
        }

        // PRODUCT LOGIC
        function handleImg(input) {
            if(input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => { curImg=e.target.result; document.getElementById('p_prev').src=curImg; document.getElementById('p_prev').style.display='block'; };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function addProduct() {
            const n=document.getElementById('p_name').value, p=document.getElementById('p_price').value, d=document.getElementById('p_desc').value, s=document.getElementById('p_status').value;
            if(n && p) {
                products.push({ id:Date.now(), name:n, price:parseInt(p), desc:d, inStock:s==="true", img:curImg });
                localStorage.setItem('products', JSON.stringify(products)); renderP(); resetForm();
            }
        }

        function editProduct(id) {
            const p = products.find(x=>x.id===id);
            document.getElementById('edit_id').value=id; document.getElementById('p_name').value=p.name;
            document.getElementById('p_price').value=p.price; document.getElementById('p_desc').value=p.desc||'';
            document.getElementById('p_status').value=p.inStock; curImg=p.img;
            document.getElementById('p_prev').src=p.img; document.getElementById('p_prev').style.display='block';
            document.getElementById('addBtn').style.display='none'; document.getElementById('updateBtn').style.display='inline-block';
        }

        function updateProduct() {
            const id=parseInt(document.getElementById('edit_id').value), idx=products.findIndex(x=>x.id===id);
            if(idx!==-1) {
                products[idx].name=document.getElementById('p_name').value;
                products[idx].price=parseInt(document.getElementById('p_price').value);
                products[idx].desc=document.getElementById('p_desc').value;
                products[idx].inStock=document.getElementById('p_status').value==="true";
                if(curImg) products[idx].img=curImg;
                localStorage.setItem('products', JSON.stringify(products)); renderP(); resetForm();
            }
        }

        function deleteProduct(id) {
            if(confirm("Delete?")) { products=products.filter(x=>x.id!==id); localStorage.setItem('products', JSON.stringify(products)); renderP(); }
        }

        function resetForm() {
            document.getElementById('p_name').value=''; document.getElementById('p_price').value=''; document.getElementById('p_desc').value='';
            document.getElementById('p_prev').style.display='none'; curImg='';
            document.getElementById('addBtn').style.display='inline-block'; document.getElementById('updateBtn').style.display='none';
        }

        function renderP() {
            document.getElementById('p_list').innerHTML = products.map(p => `
                <tr>
                    <td><img src="${p.img}" width="40" style="border-radius:4px;"></td>
                    <td>${p.name}</td>
                    <td><small>${(p.desc||'').substring(0,30)}...</small></td>
                    <td>${p.price}</td>
                    <td style="color:${p.inStock?'green':'red'}">${p.inStock?'In Stock':'Out'}</td>
                    <td><button class="btn btn-edit" onclick="editProduct(${p.id})">Edit</button> <button class="btn btn-del" onclick="deleteProduct(${p.id})">Del</button></td>
                </tr>
            `).join('');
        }

        // ORDER LOGIC
        function renderO() {
            orders = JSON.parse(localStorage.getItem('orders')) || [];
            document.getElementById('o_list').innerHTML = orders.map(o => `
                <tr>
                    <td>#${o.id.toString().slice(-4)}</td>
                    <td>${o.userName}<br>${o.phone}</td>
                    <td><small>${o.address}</small></td>
                    <td>${o.items}<br><b>${o.total}</b></td>
                    <td>
                        <select onchange="upStatus(${o.id}, this.value)">
                            <option value="Pending" ${o.status==='Pending'?'selected':''}>Pending</option>
                            <option value="Confirmed" ${o.status==='Confirmed'?'selected':''}>Confirmed</option>
                            <option value="Delivered" ${o.status==='Delivered'?'selected':''}>Delivered</option>
                        </select>
                    </td>
                    <td><button class="btn btn-del" onclick="delOrder(${o.id})">X</button></td>
                </tr>
            `).join('');
        }
        function upStatus(id, s) { 
            const idx=orders.findIndex(o=>o.id===id); if(idx!==-1) { orders[idx].status=s; localStorage.setItem('orders', JSON.stringify(orders)); } 
        }
        function delOrder(id) { 
            if(confirm("Delete Order?")) { orders=orders.filter(o=>o.id!==id); localStorage.setItem('orders', JSON.stringify(orders)); renderO(); } 
        }

        renderP();
    </script>
</body>
</html>
