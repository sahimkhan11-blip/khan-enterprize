// --- Firebase Config (Same as index.html) ---
// ... (Firebase Initialize Code here) ...
const db = firebase.firestore();

// --- UPDATE STATUS FUNCTION ---
function updateStatus(orderId, newStatus, userEmail) {
    // 1. Update Order in Firestore
    db.collection("orders").doc(orderId).update({
        status: newStatus
    }).then(() => {
        // 2. Send Notification to User
        let title = "Order Update ğŸ“¦";
        let msg = `Your order status has been updated to: ${newStatus}`;
        
        if(newStatus === "Delivered") {
            title = "Order Delivered ğŸ‰";
            msg = "Your order has been successfully delivered. Thank you for shopping with us!";
        } else if (newStatus === "Cancelled") {
            title = "Order Cancelled âŒ";
            msg = "Your order has been cancelled. Please contact support for details.";
        } else if (newStatus === "Confirmed") {
            title = "Order Confirmed âœ…";
            msg = "We have received your order and are processing it.";
        }

        db.collection("notifications").add({
            userEmail: userEmail,
            title: title,
            message: msg,
            read: false,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        alert("Status Updated & Notification Sent!");
        renderOrders(); // Refresh table
    });
}
